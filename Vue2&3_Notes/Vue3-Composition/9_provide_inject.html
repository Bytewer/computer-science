<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Document</title>
	<script src="../lib/vue.global.js"></script>
</head>

<body>
	<div id='root'></div>
</body>

<script>
	// watcheffect 侦听器，更偏向effect
	const app = Vue.createApp({
		template: `
            <div>
                <child />
            </div>
        `,
		// 在生命周期函数中是没有beforeCreate、created, 因为setup执行点就在之间
		setup(props, context) {
			const {
				ref,
				provide,
				readonly
			} = Vue

			// 为了保证单项数据流, 传给子组件使用readonly
			const name = ref('dell')

			provide('name', readonly(name))
			provide('changeName', (value) => {
				name.value = value
			})

			return {
				
			}
		}
	})

	app.component('child', {
		template: `
				<div @click='handleClick'>{{name}}</div>
			`,
		setup() {
			const {
				inject
			} = Vue
			const name = inject('name')

			const changeName = inject('changeName')

			const handleClick = () => {
				changeName('lee')
			}
			return {
				name,
				handleClick
			}
		}
	})

	const vm = app.mount('#root')
</script>

</html>